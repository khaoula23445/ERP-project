<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="assets/images/favicon.svg" type="image/x-icon" />
    <title>Tables | PlainAdmin Demo</title>
   
  
    <style>
      
      .details-row .version-details {
        padding: 10px; background: #f9f9f9; border-left: 3px solid #007bff;
      }
      
    </style>
  <style>
    .modal-content {
        width: 90%; /* Set the width of the modal */
        max-width: 1000px; /* Limit maximum width */
    }
   
    .form-label {
      color: #1A2142;;
    font-weight:500;
    font-size: smaller;
    display: block;
    text-align: left;
    margin-bottom: 5px;
    }

    

    .row.mb-3 {
        margin-bottom: 1rem; /* Reduced space to manage height */
    }
  
</style>
  </style>
    <!-- ========== All CSS files linkup ========= -->
    {% load static %}
<!-- Bootstrap JavaScript Bundle (includes Popper) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6oB8mMQIP1XumxWxF0VS+zY+Lsrl6hW6JARw/s8XKek5tP1Lcv7" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="{% static 'assets/css/bootstrap.min.css' %}" />
    <link rel="stylesheet" href="{% static 'assets/css/lineicons.css' %}" />
    <link rel="stylesheet" href="{% static 'assets/css/materialdesignicons.min.css' %}" />
    <link rel="stylesheet" href="{% static 'assets/css/fullcalendar.css' %}" />
    <link rel="stylesheet" href="{% static 'assets/css/main.css' %}" />
    <link rel="stylesheet" href="{% static 'assets/css/popup.css' %}" />
    <style>
      .dropdown-text {
    font-size: 13px; /* Change the font size as needed */
    padding: 0; /* Adjust padding if necessary */
    margin: 0; /* Adjust margin if necessary */
}

   .table thead th,
.table tbody td {
    text-align: center; /* Center-aligns text within <th> and <td> elements */
}

.table thead th h6 {
    margin: 0;
}
      .small-search {
  width: 200px;
}



        /* Center the toggle buttons in the middle of the page */
        .table-toggle-buttons {
          display: flex;
          justify-content: center;
          align-items: center;
          gap: 10px;
          margin-bottom: 20px;
        }
    
        .centered-wrapper {
          display: flex;
          justify-content: center;
          align-items: center;
          height: 100vh;
        }
    
        .custom-button {
          font-size: 14px;
          padding: 8px 16px;
        }
      </style>
  </head>
  <body>
    <!-- ======== Preloader =========== -->
    <div id="preloader">
      <div class="spinner"></div>
    </div>
    <!-- ======== Preloader =========== -->

    <!-- ======== sidebar-nav start =========== -->
    {% include 'pages/sidebar.html' %}
    <div class="overlay"></div>
    <!-- ======== sidebar-nav end =========== -->

    <main class="main-wrapper">
      <!-- ========== header start ========== -->
      {% include 'pages/header.html' %}
      <!-- ========== header end ========== -->

   
 
      <!-- ========== table components start ========== -->
      <section class="table-components">
        <div class="container-fluid">
          <div class="title-wrapper pt-30">
            <div class="row align-items-center">
              <div class="col-md-6">
                <div class="title">
                  <h2>Tables</h2>
                </div>
              </div>
              <div class="col-md-6">
                <div class="breadcrumb-wrapper">
                  <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                      <li class="breadcrumb-item">
                        <a href="#0">Dashboard</a>
                      </li>
                      <li class="breadcrumb-item active" aria-current="page">
                        Tables
                      </li>
                    </ol>
                  </nav>
                </div>
              </div>
            </div>
          </div>
      
          <!-- Toggle buttons for switching tables -->
      <div class="table-toggle-buttons">
          
          </div>

      
          <!-- Table 1 -->
          <div id="table1" class="tables-wrapper">
            <div class="row">
                <div class="col-lg-12">
                    <div class="card-style mb-30">
                        <div class="d-flex justify-content-between align-items-center mb-10">
                            <h6>Employee</h6>
                            
                            <button  class="main-btn primary-btn btn-hover custom-button" data-bs-toggle="modal" data-bs-target="#addCongeModal">Ajouter un Congé</button>
                           
                        </div>
                        <div class="table-wrapper table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <div class="d-flex justify-content-between align-items-center mb-3">
                                            <input type="text" id="tableSearch" class="form-control form-control-sm small-search" placeholder="Search..." onkeyup="filterTable()" style="width: 200px;">
                                        </div>
                                    </tr>
                                    <tr>
                                        <th onclick="sortTable2(0)"><h6>Employé  <span id="name-sort">↓↑</span></h6></th>
                                        <th onclick="sortTable2(1)"><h6>Type de Congé <span id="ssn-sort">↓↑</span></h6></th>
                                        <th onclick="sortTable2(2)"><h6>Date de Début  <span id="phone-sort">↓↑</span></h6></th>
                                        <th onclick="sortTable2(3)"><h6>Date de Fin <span id="dob-sort">↓↑</span></h6></th>
                                        <th onclick="sortTable2(4)"><h6>Nombre de Jours <span id="pob-sort">↓↑</span></h6></th>
                                        <th onclick="sortTable2(5)"><h6>Nombre de Jours Reste <span id="status-sort">↓↑</span></h6></th>
                                        <th onclick="sortTable2(6)"><h6>Status <span id="dept-sort">↓↑</span></h6></th>
                                        <th><h6>Actions</h6></th>
                                    </tr>
                                    
                                </thead>
                                <tbody>
                                    {% for conge in conges %}
                                        <tr>
                                            <td><p>{{ conge.employee.firstname }} {{ conge.employee.lastname }}</p></td>
                                            <td><p>{{ conge.conge_type }}</p></td>
                                            <td><p>{{ conge.start_date }}</p></td>
                                            <td><p>{{ conge.end_date }}</p></td>
                                            <td><p>{{ conge.num_days }}</p></td>
                                            <td><p>{{ conge.num_days_rest }}</p></td>
                                            <td> <p>
                                                <span 
                                                class="status-btn" 
                                                style="
                                                    color: #ffffff; 
                                                    padding: 7px 15px; 
                                                    border-radius: 30px; 
                                                    font-size: 14px; 
                                                    font-weight: 400;
                                                    background: 
                                                    {% if conge.status == 'terminé' %} 
                                                    #FF737E
                                                {% else %} 
                                                #65c98b
                                                    {% endif %}
                                                ">
                                                {{ conge.status }}
                                            </span>
                                            
                                              </p></td>
                                            <td class="min-width">
                                                <span class="icon" onclick="toggleDropdown(event)">
                                                    <span class="mdi mdi-dots-vertical"></span> <!-- 3-dot icon -->
                                                </span>
                                            
                                                <div class="dropdown-menu" style="right: 0; left: auto;">
                                                    <ul class="list-unstyled">
                                                        <li>
                                                            <button class="dropdown-item text-danger d-flex align-items-center"  onclick="openDeleteModal('{{ conge.idconge }}')"><span class="dropdown-text">Supprimer</span>
                                                                <i class="lni lni-trash-can icon-spacing ms-auto"></i></button>
                                                        </li>
                                                        <li>
                                                            <button class="dropdown-item d-flex align-items-center"
    onclick="openEditModal({
        idconge: '{{ conge.idconge }}', 
        employee: '{{ conge.employee.id }}', 
        conge_type: '{{ conge.conge_type }}', 
        start_date: '{{ conge.start_date }}', 
        end_date: '{{ conge.end_date }}', 
        num_days: '{{ conge.num_days }}', 
        num_days_rest: '{{ conge.num_days_rest }}', 
        status: '{{ conge.status }}'
    })">
    <span class="dropdown-text">Modifier</span>
    <span class="mdi mdi-pencil icon-spacing ms-auto"></span>
</button>

                                                        </li>
                                                    </ul>
                                                </div>
                                            </td>
                                        </tr>
                    
                                    {% empty %}
                                        <tr>
                                            <td colspan="5">Aucun congé trouvé.</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        


   <!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteCongeModal" tabindex="-1" aria-labelledby="deleteConfirmationLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteConfirmationLabel">Confirmation de Suppression</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Êtes-vous sûr de vouloir supprimer ce congé ?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                <form id="deleteCongeForm">
                    {% csrf_token %}
                    <input type="hidden" id="delete_conge_id">
                    <button type="submit" class="btn btn-danger">Supprimer</button>
                </form>
                <div id="delete-error-message" class="text-danger mt-2" style="display:none;"></div>
                <div id="delete-success-message" class="text-success mt-2" style="display:none;"></div>
            </div>
        </div>
    </div>
</div>

    
<div class="modal fade" id="editCongeModal" tabindex="-1" aria-labelledby="editCongeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg"> <!-- Make the modal wider -->
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editCongeModalLabel">Modifier un Congé</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editCongeForm">
                    {% csrf_token %}
                    <input type="hidden" id="edit_conge_id">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="edit_employee_id" class="form-label">Employé</label>
                            <select id="edit_employee_id" class="form-select" style="font-size: 14px;" required>
                                {% for employee in employee %}
                                    <option value="{{ employee.idemployee }}">{{ employee.firstname }} {{ employee.lastname }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="edit_conge_type" class="form-label">Type de Congé</label>
                            <select id="edit_conge_type" class="form-select" style="font-size: 14px;" required>
                                <option value="Payé">Congé Payé</option>
                                <option value="non Payé">Congé Sans Solde</option>
                                <option value="maternité">Congé Maternité</option>
                                <option value="exceptional">Congé Exceptionnel</option>
                            </select>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label for="edit_start_date" class="form-label">Date de Début</label>
                            <input type="date" id="edit_start_date" class="form-control input-small-text" style="font-size: 14px;" required>
                        </div>
                        <div class="col-md-4">
                            <label for="edit_num_days" class="form-label">Nombre de Jours</label>
                            <input type="number" id="edit_num_days" class="form-control input-small-text" style="font-size: 14px;" required>
                        </div>
                        <div class="col-md-4">
                            <label for="edit_end_date" class="form-label">Date de Fin</label>
                            <input type="date" id="edit_end_date" class="form-control input-small-text" style="font-size: 14px;" readonly>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Modifier</button>
                </form>
                <div id="edit-error-message" class="text-danger mt-2" style="display:none;"></div>
                <div id="edit-success-message" class="text-success mt-2" style="display:none;"></div>
            </div>
        </div>
    </div>
</div><div class="modal fade" id="addCongeModal" tabindex="-1" aria-labelledby="addCongeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg"> <!-- Use modal-lg for a wider modal -->
        <div class="modal-content">
            <form id="addCongeForm" method="post">
                {% csrf_token %}
                <div class="modal-header">
                    <h5 class="modal-title" id="addCongeModalLabel">Ajouter un Congé</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="employee_id" class="form-label">Employé</label>
                            <select id="employee_id" class="form-select" required>
                                {% for employee in employee %}
                                    <option value="{{ employee.idemployee }}">{{ employee.firstname }} {{ employee.lastname }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="conge_type" class="form-label">Type de Congé</label>
                            <select id="conge_type" class="form-select" required>
                                <option value="Payé">Congé Payé</option>
                                <option value="non Payé">Congé Sans Solde</option>
                                <option value="maternité">Congé Maternité</option>
                                <option value="exceptional">Congé Exceptionnel</option>
                            </select>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="start_date" class="form-label">Date de Début</label>
                            <input type="date" id="start_date" class="form-control" required>
                        </div>
                        <div class="col-md-6">
                            <label for="num_days" class="form-label">Nombre de Jours</label>
                            <input type="number" id="num_days" class="form-control" required>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="end_date" class="form-label">Date de Fin</label>
                            <input type="date" id="end_date" class="form-control" readonly>
                        </div>
                    </div>
                    <div id="error-message" class="text-danger mt-2" style="display:none;"></div>
                    <div id="success-message" class="text-success mt-2" style="display:none;"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <button type="submit" class="btn btn-primary">Ajouter</button>
                </div>
            </form>
        </div>
    </div>
      </section>
      
      <!-- ========== table components end ========== -->

      <!-- ========== footer start =========== -->
  
      <!-- ========== footer end =========== -->
    </main>
    <!-- ======== main-wrapper end =========== -->

    <!-- ========= All Javascript files linkup ======== -->

    <script src="{% static 'assets/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'assets/js/Chart.min.js' %}"></script>
    <script src="{% static 'assets/js/dynamic-pie-chart.js' %}"></script>
    <script src="{% static 'assets/js/moment.min.js' %}"></script>
    <script src="{% static 'assets/js/fullcalendar.js' %}"></script>
    <script src="{% static 'assets/js/jvectormap.min.js' %}"></script>
    <script src="{% static 'assets/js/world-merc.js' %}"></script>
    <script src="{% static 'assets/js/polyfill.js' %}"></script>
    <script src="{% static 'assets/js/main.js' %}"></script>
  </body>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    function calculateEndDate() {
        const startDate = $('#start_date').val();
        const numDays = parseInt($('#num_days').val());

        if (startDate && numDays > 0) {
            const start = new Date(startDate);
            const end = new Date(start);
            end.setDate(start.getDate() + numDays - 1);

            const endDateFormatted = end.toISOString().split('T')[0];
            $('#end_date').val(endDateFormatted);
        }
    }

    $(document).ready(function() {
        $('#num_days, #start_date').on('input', calculateEndDate);

        $('#addCongeForm').submit(function(e) {
            e.preventDefault();

            var formData = {
                'employee_id': $('#employee_id').val(),
                'conge_type': $('#conge_type').val(),
                'start_date': $('#start_date').val(),
                'end_date': $('#end_date').val(),
                'num_days': $('#num_days').val(),
                'csrfmiddlewaretoken': $('input[name="csrfmiddlewaretoken"]').val(),
            };

            $.ajax({
                type: 'POST',
                url: '{% url "add_conge" %}',
                data: formData,
                success: function(response) {
                    console.log("AJAX response received:", response);

                    if (response.status === 'success') {
                        $('#success-message').text(response.message).show();
                        console.log("Success message shown.");

                        // Close the modal first
                        $('#addCongeModal').modal('hide');
                        console.log("Modal should now be hidden.");

                        // Reload the page with a short delay to allow modal to close
                        setTimeout(function() {
                            location.reload();
                        }, 500); // 500 milliseconds delay
                    } else {
                        $('#error-message').text(response.message).show();
                        console.log("Error message shown:", response.message);
                    }
                },
                error: function(xhr, status, error) {
                    console.error("Error occurred during AJAX:", error);
                    $('#error-message').text('Une erreur est survenue.').show();
                }
            });
        });
    });
</script>
<script>
    function toggleDropdown(event) {
        event.stopPropagation();
        const dropdown = event.target.closest('.min-width').querySelector('.dropdown-menu');
        dropdown.classList.toggle('show'); // Toggles visibility
    }
    
    // Close dropdown if clicked outside
    document.addEventListener('click', (e) => {
        document.querySelectorAll('.dropdown-menu').forEach(dropdown => {
            if (!dropdown.contains(e.target)) {
                dropdown.classList.remove('show');
            }
        });
    });
    </script>
    
<script>
     
    function openDeleteModal(congeId) {
        $('#delete_conge_id').val(congeId); // Set the hidden input in the delete form
        $('#deleteCongeModal').modal('show'); // Show the delete confirmation modal
    }

    // AJAX for Delete Function
    $('#deleteCongeForm').submit(function(e) {
        e.preventDefault();

        var formData = {
            'conge_id': $('#delete_conge_id').val(),
            'csrfmiddlewaretoken': $('input[name="csrfmiddlewaretoken"]').val(),
        };

        $.ajax({
            type: 'POST',
            url: '{% url "delete_conge" %}',
            data: formData,
            success: function(response) {
                if (response.status === 'success') {
                    $('#delete-success-message').text(response.message).show();
                    $('#deleteCongeModal').modal('hide');
                    setTimeout(function() {
                        location.reload();
                    }, 500);
                } else {
                    $('#delete-error-message').text(response.message).show();
                }
            },
            error: function(xhr, status, error) {
                $('#delete-error-message').text('Une erreur est survenue.').show();
            }
        });
    });
</script>
     <script>
     document.getElementById('editCongeForm').addEventListener('submit', function (e) {
    e.preventDefault(); // Prevent default form submission

    // Gather data from the form
    const formData = new FormData(this);

    // Send AJAX request
    fetch('/update-conge/', {
        method: 'POST',
        body: formData,
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
        },
    })
        .then((response) => response.json())
        .then((data) => {
            if (data.success) {
                // Show success message and reload table
                document.getElementById('edit-success-message').style.display = 'block';
                document.getElementById('edit-success-message').textContent = data.message;

                // Hide modal and refresh the page or table
                const modal = bootstrap.Modal.getInstance(document.getElementById('editCongeModal'));
                modal.hide();
                window.location.reload(); // Refresh to update the list
            } else {
                // Show error message
                document.getElementById('edit-error-message').style.display = 'block';
                document.getElementById('edit-error-message').textContent = data.message;
            }
        })
        .catch((error) => {
            console.error('Error:', error);
            document.getElementById('edit-error-message').style.display = 'block';
            document.getElementById('edit-error-message').textContent = 'An error occurred while updating the congé.';
        });
});

    </script>
    <script> // JavaScript function to filter table rows based on search input
        function filterTable() {
        // Get the search input value and convert it to uppercase for case-insensitive search
        const searchInput = document.getElementById('tableSearch').value.toUpperCase();
        
        // Determine which table is currently visible
        const activeTable = document.getElementById('table1').style.display !== 'none' ? 'table1' : 'table2';
        
        // Get the rows of the active table
        const table = document.getElementById(activeTable);
        const rows = table.getElementsByTagName('tr');
    
        // Loop through each row (skip the header row)
        for (let i = 1; i < rows.length; i++) {
            let row = rows[i];
            let textContent = row.textContent || row.innerText;
            
            // Check if row text includes the search value
            if (textContent.toUpperCase().indexOf(searchInput) > -1) {
                row.style.display = ""; // Show row
            } else {
                row.style.display = "none"; // Hide row
            }
        }
    }
    </script>
       <script>let sortOrder = {}; // To track sorting state for each column

        function sortTable(columnIndex) {
            const table = document.querySelector('table tbody');
            const rows = Array.from(table.rows);
            const header = table.previousElementSibling.querySelectorAll('th');
            const icon = header[columnIndex].querySelector('span'); // Get the span for the clicked column
        
            const currentOrder = sortOrder[columnIndex] || 'asc'; // Default to ascending
        
            // Toggle sort order for the next click
            sortOrder[columnIndex] = currentOrder === 'asc' ? 'desc' : 'asc';
        
            // Sort the rows
            rows.sort((a, b) => {
                const cellA = a.cells[columnIndex].textContent.trim();
                const cellB = b.cells[columnIndex].textContent.trim();
        
                let comparison = 0;
        
                // Number comparison for salary and id columns (if needed)
                if (columnIndex === 4 || columnIndex === 0) {
                    comparison = parseFloat(cellA) - parseFloat(cellB);
                } else {
                    comparison = cellA.localeCompare(cellB);
                }
        
                return currentOrder === 'asc' ? comparison : -comparison;
            });
        
            // Reorder the rows in the table
            rows.forEach(row => table.appendChild(row));
        
            // Update the sorting icons
            resetSortingIcons(); // Reset all icons
            icon.innerHTML = currentOrder === 'asc' ? '↑' : '↓'; // Show the correct icon for the clicked column
        }
        
        function resetSortingIcons() {
            // Clear all sorting icons
            const icons = document.querySelectorAll('th span');
            icons.forEach(icon => icon.innerHTML = '↓↑'); // Reset all icons to the default '↓↑'
        }
        
        </script>
        <script>function filterTable() {
            // Get the input value
            let filter = document.getElementById("tableSearch2").value.toLowerCase();
            // Get the table rows
            let rows = document.querySelectorAll("#table2 tbody tr");
        
            // Loop through the rows and hide those that don't match the filter
            rows.forEach(function(row) {
                let cells = row.querySelectorAll("td");
                let rowText = "";
                
                // Concatenate text from each cell in the row
                cells.forEach(function(cell) {
                    rowText += cell.textContent.toLowerCase();
                });
        
                // If the row's text content matches the filter, show the row, otherwise hide it
                if (rowText.indexOf(filter) > -1) {
                    row.style.display = "";
                } else {
                    row.style.display = "none";
                }
            });
        }
        
        </script>
  


</html>
