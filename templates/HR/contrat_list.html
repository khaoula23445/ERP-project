<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="assets/images/favicon.svg" type="image/x-icon" />
    <title>Tables | PlainAdmin Demo</title>
   
  
    <style>
      
      .details-row .version-details {
        padding: 10px; background: #f9f9f9; border-left: 3px solid #007bff;
      }
      
    </style>
  <style>
    .modal-content {
        width: 90%; /* Set the width of the modal */
        max-width: 1000px; /* Limit maximum width */
    }
   
    .form-label {
      color: #1A2142;;
    font-weight:500;
    font-size: smaller;
    display: block;
    text-align: left;
    margin-bottom: 5px;
    }

    

    .row.mb-3 {
        margin-bottom: 1rem; /* Reduced space to manage height */
    }
  
</style>
  </style>
    <!-- ========== All CSS files linkup ========= -->
    {% load static %}
<!-- Bootstrap JavaScript Bundle (includes Popper) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6oB8mMQIP1XumxWxF0VS+zY+Lsrl6hW6JARw/s8XKek5tP1Lcv7" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="{% static 'assets/css/bootstrap.min.css' %}" />
    <link rel="stylesheet" href="{% static 'assets/css/lineicons.css' %}" />
    <link rel="stylesheet" href="{% static 'assets/css/materialdesignicons.min.css' %}" />
    <link rel="stylesheet" href="{% static 'assets/css/fullcalendar.css' %}" />
    <link rel="stylesheet" href="{% static 'assets/css/main.css' %}" />
    <link rel="stylesheet" href="{% static 'assets/css/popup.css' %}" />
    <style>
      .dropdown-text {
    font-size: 13px; /* Change the font size as needed */
    padding: 0; /* Adjust padding if necessary */
    margin: 0; /* Adjust margin if necessary */
}

   .table thead th,
.table tbody td {
    text-align: center; /* Center-aligns text within <th> and <td> elements */
}

.table thead th h6 {
    margin: 0;
}
      .small-search {
  width: 200px;
}



        /* Center the toggle buttons in the middle of the page */
        .table-toggle-buttons {
          display: flex;
          justify-content: center;
          align-items: center;
          gap: 10px;
          margin-bottom: 20px;
        }
    
        .centered-wrapper {
          display: flex;
          justify-content: center;
          align-items: center;
          height: 100vh;
        }
    
        .custom-button {
          font-size: 14px;
          padding: 8px 16px;
        }
      </style>
  </head>
  <body>
    <!-- ======== Preloader =========== -->
    <div id="preloader">
      <div class="spinner"></div>
    </div>
    <!-- ======== Preloader =========== -->

    <!-- ======== sidebar-nav start =========== -->
    {% include 'pages/sidebar.html' %}
    <div class="overlay"></div>
    <!-- ======== sidebar-nav end =========== -->

    <main class="main-wrapper">
      <!-- ========== header start ========== -->
      {% include 'pages/header.html' %}
      <!-- ========== header end ========== -->

   
 
      <!-- ========== table components start ========== -->
      <section class="table-components">
        <div class="container-fluid">
          <div class="title-wrapper pt-30">
            <div class="row align-items-center">
              <div class="col-md-6">
                <div class="title">
                  <h2>Tables</h2>
                </div>
              </div>
              <div class="col-md-6">
                <div class="breadcrumb-wrapper">
                  <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                      <li class="breadcrumb-item">
                        <a href="#0">Dashboard</a>
                      </li>
                      <li class="breadcrumb-item active" aria-current="page">
                        Tables
                      </li>
                    </ol>
                  </nav>
                </div>
              </div>
            </div>
          </div>
      
          <!-- Toggle buttons for switching tables -->
    
      
          <!-- Table 1 -->
          <div id="table1" class="tables-wrapper">
            <div class="row">
                <div class="col-lg-12">
                    <div class="card-style mb-30">
                        <div class="d-flex justify-content-between align-items-center mb-10">
                            <h6> Contrats</h6>
                         
                        </div>
                        <div class="table-wrapper table-responsive">
                            <table class="table">
                              <thead>
                              <tr><div class="d-flex justify-content-between align-items-center mb-3">
                                  <input type="text" id="tableSearch" class="form-control form-control-sm small-search" placeholder="Search..." onkeyup="filterTable()" style="width: 200px;">
                              </div>
                              </tr>
                                <tr>
                            
                                  <th onclick="sortTable(0)"><h6>Employee <span id="name-sort">↓↑</span></h6></th>
        <th onclick="sortTable(1)"><h6>Date de debut <span id="ssn-sort">↓↑</span></h6></th>
        <th onclick="sortTable(2)"><h6>Date de fin <span id="phone-sort">↓↑</span></h6></th>
        <th onclick="sortTable(3)"><h6>Type de contrat <span id="dob-sort">↓↑</span></h6></th>
        <th onclick="sortTable(4)"><h6>Status <span id="pob-sort">↓↑</span></h6></th>
        <th onclick="sortTable(5)"><h6>Actions </h6></th>
                                </tr>
                            </thead>
                              
                            <tbody>
                              {% for contract in contracts %}
                              <tr>

                                  <td class="min-width"><p>{{ contract.employee.firstname }} {{ contract.employee.lastname }}</p></td> 
                             
                                  <td class="min-width"><p>{{ contract.start_date }}</p></td>
                                  <td class="min-width"><p>{{ contract.end_date }}</p></td>
                                  <td class="min-width"><p>{{ contract.contrat_type}}</p></td>
                                  <td class="min-width">
                                    <p>
                                      <span 
                                      class="status-btn" 
                                      style="
                                          color: #ffffff; 
                                          padding: 7px 15px; 
                                          border-radius: 30px; 
                                          font-size: 14px; 
                                          font-weight: 400;
                                          background: 
                                          {% if contract.status == 'Inactive' %} 
                                          #FF737E
                                      {% else %} 
                                      #65c98b
                                          {% endif %}
                                      ">
                                      {{ contract.status }}
                                  </span>
                                  
                                    </p>
                                </td>
                                
                                
                                  <td class="min-width">
                                      <!-- Dropdown Button (3 dots) -->
                                      <span class="icon" onclick="toggleDropdown(event)">
                                        <span class="mdi mdi-dots-vertical"></span><!-- 3-dot icon -->
                                      </span>                                      
                                    
                                      <!-- Dropdown Menu (initially hidden) -->
                                      <ul class="dropdown-menu" style="right: 0; left: auto;">
                                        <li>
                                          <button class="dropdown-item d-flex align-items-center" data-bs-toggle="modal" data-bs-target="#updateModal"
        data-id="{{ contract.idcontrat }}" 
        data-employee="{{ contract.employee.firstname }}"
        data-type="{{ contract.contrat_type }}" 
        data-start="{{ contract.start_date }}" 
        data-end="{{ contract.end_date }}" 
        data-salary="{{ contract.salary_amount }}" 
        data-status="{{ contract.status }}" 
        data-work_hours="{{ contract.work_hours }}" 
        data-work_location="{{ contract.work_location }}" 
        data-contrat_terms="{{ contract.contrat_terms }}" 
        data-job_title="{{ contract.job_title }}"
        data-end_date="{{ contract.end_date }}" 
        data-function="{{ contract.job_title }}"
        data-created="{{ contract.created_at }}">
    <span class="dropdown-text">Modifier</span>
    <span class="mdi mdi-pencil icon-spacing ms-auto"></span>
</button>

                                        </li>
                                        <li>
                                          <button class="dropdown-item text-danger d-flex align-items-center" data-bs-toggle="modal" data-bs-target="#deleteModal"
                                                  data-id="{{ contract.idcontrat }}">
                                                  <span class="dropdown-text">Delete</span>
                                                  <i class="lni lni-trash-can icon-spacing ms-auto"></i>
                                          </button>
                                        </li>
                                        <li>
                                          <a href="{% url 'view_contract' contract.idcontrat %}" class="dropdown-item d-flex align-items-center">
                                            <span class="dropdown-text">Details</span>
                                            <span class="mdi mdi-eye icon-spacing ms-auto"></span>
                                          </a>
                                        </li>
                                      </ul>
                                    </td>
                                    
                                    <!-- Modal for Assign Project (example) -->
                                    <div class="modal fade" id="assignProjectModal" tabindex="-1" aria-labelledby="assignProjectModalLabel" aria-hidden="true">
                                      <div class="modal-dialog">
                                        <div class="modal-content">
                                          <!-- Modal Content -->
                                          <div class="modal-header">
                                            <h5 class="modal-title" id="assignProjectModalLabel">Assign Project</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                          </div>
                                          <div class="modal-body">
                                            <input type="hidden" id="employeeIdInput">
                                            <!-- Other modal content like input fields can go here -->
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                    
                              </tr>
                              {% endfor %}
                          </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
  <!-- Modal de mise à jour -->
<div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
      <div class="modal-content">
          <form id="updateForm">
              <div class="modal-header">
                  <h5 class="modal-title" id="updateModalLabel">Mettre à jour le contrat</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                  <input type="hidden" id="updateContractId">

                  <!-- Row 1 -->
                  <div class="row mb-3">
                      <div class="col-md-3">
                          <label for="updateEmployee" class="form-label">Employé</label>
                          <input type="text" class="form-control input-small-text" id="updateEmployee" readonly style="font-size: 14px;">
                      </div>
                      <div class="col-md-3">
                        <label for="updateType" class="form-label">Type</label>
                        <select class="form-control input-small-text" id="updateType" style="font-size: 14px;">
                            <option value="Contrat d'Apprentissage">Permanent</option>
                            <option value="CDD">CDD</option>
                            <option value="contract">Contrat</option>
                        </select>
                      </div>
                      <div class="col-md-3">
                          <label for="updateStartDate" class="form-label">Date de début</label>
                          <input type="date" class="form-control input-small-text" id="updateStartDate" style="font-size: 14px;">
                      </div>
                      <div class="col-md-3">
                          <label for="updateEndDate" class="form-label">Date de fin</label>
                          <input type="date" class="form-control input-small-text" id="updateEndDate" style="font-size: 14px;">
                      </div>
                  </div>

                  <!-- Row 2 -->
                  <div class="row mb-3">
                      <div class="col-md-3">
                          <label for="updateSalary" class="form-label">Salaire</label>
                          <input type="text" class="form-control input-small-text" id="updateSalary" style="font-size: 14px;">
                      </div>
                      <div class="col-md-3">
                        <label for="updateType" class="form-label">Statut</label>
                        <select class="form-control input-small-text" id="updateStatus" style="font-size: 14px;">
                          <option value="Active">Active</option>
                          <option value="Inactive">Inactive</option>
                       
                      </select>
                      </div>
                      <div class="col-md-3">
                          <label for="updateFunction" class="form-label">Fonction</label>
                          <input type="text" class="form-control input-small-text" id="updateFunction" style="font-size: 14px;">
                      </div>
                      <div class="col-md-3">
                          <label for="updateWorkLocation" class="form-label">Lieu de travail</label>
                          <input type="text" class="form-control input-small-text" id="updateWorkLocation" style="font-size: 14px;">

                      </div>
                  </div>

                  <!-- Row 3 -->
                  <div class="row mb-3">
                      <div class="col-md-3">
                          <label for="updateWorkHours" class="form-label">Heures de travail</label>
                          <input type="number" class="form-control input-small-text" id="updateWorkHours" style="font-size: 14px;">
                      </div>
                   
                      <div class="col-md-3">
                          <label for="updateContractTerms" class="form-label">Termes du contrat</label>
                          <textarea class="form-control input-small-text" id="updateContractTerms" style="font-size: 14px;"></textarea>
                      </div>
                  </div>
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                  <button type="submit" class="btn btn-primary">Enregistrer les modifications</button>
              </div>
          </form>
      </div>
  </div>
</div>

  </div>
</div>



<!-- Modal de suppression -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title" id="deleteModalLabel">Supprimer le contrat</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
              Êtes-vous sûr de vouloir supprimer ce contrat ?
              <input type="hidden" id="deleteContractId">
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
              <button type="button" class="btn btn-danger" id="confirmDelete">Supprimer</button>
          </div>
      </div>
  </div>
</div>

      </section>
      
      <!-- ========== table components end ========== -->

      <!-- ========== footer start =========== -->
  
      <!-- ========== footer end =========== -->
    </main>
    <!-- ======== main-wrapper end =========== -->

    <!-- ========= All Javascript files linkup ======== -->

    <script src="{% static 'assets/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'assets/js/Chart.min.js' %}"></script>
    <script src="{% static 'assets/js/dynamic-pie-chart.js' %}"></script>
    <script src="{% static 'assets/js/moment.min.js' %}"></script>
    <script src="{% static 'assets/js/fullcalendar.js' %}"></script>
    <script src="{% static 'assets/js/jvectormap.min.js' %}"></script>
    <script src="{% static 'assets/js/world-merc.js' %}"></script>
    <script src="{% static 'assets/js/polyfill.js' %}"></script>
    <script src="{% static 'assets/js/main.js' %}"></script>
  </body>

  <script>

// Populate update modal with contract data

$('#updateModal').on('show.bs.modal', function (event) {
    const button = $(event.relatedTarget);  // Button that triggered the modal
    $('#updateContractId').val(button.data('id'));
    $('#updateEmployee').val(button.data('employee'));
    $('#updateType').val(button.data('type')).change();
    $('#updateStartDate').val(button.data('start'));
    $('#updateEndDate').val(button.data('end'));
    $('#updateSalary').val(button.data('salary'));
    $('#updateStatus').val(button.data('status'));
    $('#updateFunction').val(button.data('function'));
    $('#updateWorkLocation').val(button.data('work_location'));
    $('#updateWorkHours').val(button.data('work_hours'));
    $('#updateCreatedAt').val(button.data('created'));
    $('#updateContractTerms').val(button.data('contrat_terms'));
});

$('#updateForm').submit(function (event) {
    event.preventDefault();
    const data = {
        id: $('#updateContractId').val(),
        type: $('#updateType').val(),
        start_date: $('#updateStartDate').val(),
        end_date: $('#updateEndDate').val(),
        salary_amount: $('#updateSalary').val(),
        status: $('#updateStatus').val(),
        created : $('#updateCreatedAt').val(),
        function: $('#updateFunction').val(),
        work_location: $('#updateWorkLocation').val(),  // Ensure this is correctly set
        work_hours: $('#updateWorkHours').val(),
        contrat_terms: $('#updateContractTerms').val(),
        csrfmiddlewaretoken: '{{ csrf_token }}'
    };
    $.ajax({
        url: `/update_contract/${data.id}/`,
        type: 'POST',
        data: data,
        success: function (response) {
            if (response.success) {
                location.reload();
            } else {
                alert('Erreur : ' + response.error);
            }
        },
        error: function (xhr, status, error) {
            console.error('AJAX error:', status, error);
        }
    });
});


    // Delete contract
    $('#deleteModal').on('show.bs.modal', function (event) {
        const button = $(event.relatedTarget);
        $('#deleteContractId').val(button.data('id'));
    });
    
    $('#confirmDelete').click(function () {
        const id = $('#deleteContractId').val();
        $.ajax({
            url: `/delete_contract/${id}/`,
            type: 'POST',
            data: { csrfmiddlewaretoken: '{{ csrf_token }}' },
            success: function (response) {
                if (response.success) {
                    location.reload();
                }
            }
        });
    });
    </script>
    <!-- ========= All Javascript files linkup ======== -->
    <script>
        // Toggle the visibility of the dropdown menu
        function toggleDropdown(event) {
            event.stopPropagation(); // Prevent the event from propagating up to document
            
            // Find the closest dropdown menu
            const dropdown = event.target.closest('td').querySelector('.dropdown-menu');
            
            // Toggle the dropdown visibility
            dropdown.style.display = dropdown.style.display === 'none' || dropdown.style.display === '' ? 'block' : 'none';
        }
    
        // Close the dropdown if the user clicks anywhere outside
        document.addEventListener('click', function(event) {
            // Close all dropdowns if the click is outside
            const dropdowns = document.querySelectorAll('.dropdown-menu');
            dropdowns.forEach(dropdown => {
                // Check if the click was outside of the dropdown button
                if (!dropdown.contains(event.target) && !event.target.closest('button')) {
                    dropdown.style.display = 'none';
                }
            });
        });
    
        // Show the modal and populate the employee ID (example)
        function showAssignProjectModal(employeeName, employeeId) {
            document.getElementById("employeeIdInput").value = employeeId;
            $('#assignProjectModal').modal('show');
        }
         
    // JavaScript function to filter table rows based on search input
    function filterTable() {
    // Get the search input value and convert it to uppercase for case-insensitive search
    const searchInput = document.getElementById('tableSearch').value.toUpperCase();
    
    // Determine which table is currently visible
    const activeTable = document.getElementById('table1').style.display !== 'none' ? 'table1' : 'table2';
    
    // Get the rows of the active table
    const table = document.getElementById(activeTable);
    const rows = table.getElementsByTagName('tr');

    // Loop through each row (skip the header row)
    for (let i = 1; i < rows.length; i++) {
        let row = rows[i];
        let textContent = row.textContent || row.innerText;
        
        // Check if row text includes the search value
        if (textContent.toUpperCase().indexOf(searchInput) > -1) {
            row.style.display = ""; // Show row
        } else {
            row.style.display = "none"; // Hide row
        }
    }
}

    </script>
 <script>let sortOrder = {}; // To track sorting state for each column

  function sortTable(columnIndex) {
      const table = document.querySelector('table tbody');
      const rows = Array.from(table.rows);
      const header = table.previousElementSibling.querySelectorAll('th');
      const icon = header[columnIndex].querySelector('span'); // Get the span for the clicked column
  
      const currentOrder = sortOrder[columnIndex] || 'asc'; // Default to ascending
  
      // Toggle sort order for the next click
      sortOrder[columnIndex] = currentOrder === 'asc' ? 'desc' : 'asc';
  
      // Sort the rows
      rows.sort((a, b) => {
          const cellA = a.cells[columnIndex].textContent.trim();
          const cellB = b.cells[columnIndex].textContent.trim();
  
          let comparison = 0;
  
          // Number comparison for salary and id columns (if needed)
          if (columnIndex === 4 || columnIndex === 0) {
              comparison = parseFloat(cellA) - parseFloat(cellB);
          } else {
              comparison = cellA.localeCompare(cellB);
          }
  
          return currentOrder === 'asc' ? comparison : -comparison;
      });
  
      // Reorder the rows in the table
      rows.forEach(row => table.appendChild(row));
  
      // Update the sorting icons
      resetSortingIcons(); // Reset all icons
      icon.innerHTML = currentOrder === 'asc' ? '↑' : '↓'; // Show the correct icon for the clicked column
  }
  
  function resetSortingIcons() {
      // Clear all sorting icons
      const icons = document.querySelectorAll('th span');
      icons.forEach(icon => icon.innerHTML = '↓↑'); // Reset all icons to the default '↓↑'
  }
  
  </script>
  <script>function filterTable() {
      // Get the input value
      let filter = document.getElementById("tableSearch2").value.toLowerCase();
      // Get the table rows
      let rows = document.querySelectorAll("#table2 tbody tr");
  
      // Loop through the rows and hide those that don't match the filter
      rows.forEach(function(row) {
          let cells = row.querySelectorAll("td");
          let rowText = "";
          
          // Concatenate text from each cell in the row
          cells.forEach(function(cell) {
              rowText += cell.textContent.toLowerCase();
          });
  
          // If the row's text content matches the filter, show the row, otherwise hide it
          if (rowText.indexOf(filter) > -1) {
              row.style.display = "";
          } else {
              row.style.display = "none";
          }
      });
  }
  </script>

</html>
